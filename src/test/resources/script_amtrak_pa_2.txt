# throttles

Throttle CONSIST = 204
Throttle REAR  = 209

# states

Var PA-Enable       = 1
Var PA-Half-Speed   = 8
Var PA-Summit-Speed   = 12
Var PA-Sonora-Speed   = 12
Var PA-Full-Speed   = 20

# sensors

Sensor B360         = NS768      # 49:1
Sensor B370         = NS769      # 49:2

Sensor PA-Toggle    = NS784      # 50:1
Sensor PA-Run3      = NS785      # 50:2
Sensor P3.1         = NS786      # 50:3, B503a
Sensor P3.2         = NS787      # 50:4, B503b

# turnouts

Turnout T330        = NT330

# define timers and their default value in seconds

Timer PA-Timer-370      = 9
Timer PA-Timer-370-Stop = 6
Timer PA-Timer-Summit = 8
Timer PA-Timer-P3.1   = 5
Timer PA-Timer-P3.2   = 15
Timer PA-Timer-Enable = 3
Timer PA-Timer-MidStation = 43
Timer PA-Timer-MidStationRev = 55
Timer PA-Timer-FullSpeedRev = 10
Timer PA-Timer-SonoraSpeed = 30
Timer PA-Timer-BeforeTunnel = 20
Timer PA-Timer-AfterTunnel = 50


# ---------
# Events PA
# ---------

# Setup
 PA-Toggle                            -> CONSIST Sound = 1; CONSIST Light = 1; REAR Sound = 1; REAR Light = 1; PA-Enable = 1 ; CONSIST Horn
 PA-Toggle + !PA-Enable  + PA-Run3    -> CONSIST Horn

# PA-Toggle   -> T503 = Normal;  
# PA-Toggle   -> T330 = Reverse; 

# Departure
 P3.2 + CONSIST Stopped + PA-Toggle + PA-Enable + PA-Run3 -> PA-Enable = 0; CONSIST Light = 1; CONSIST Sound = 1; REAR Light = 1 ; REAR Sound = 1; CONSIST Horn; CONSIST Forward = PA-Half-Speed 
 P3.1 + CONSIST Forward                    -> CONSIST Forward = PA-Full-Speed ; Start = PA-Timer-MidStation

# Mid-Station
PA-Timer-MidStation    + CONSIST Forward -> End = PA-Timer-MidStation    ; CONSIST Horn ; CONSIST Forward = PA-Sonora-Speed ; Start = PA-Timer-SonoraSpeed ; Start = PA-Timer-BeforeTunnel ; Start = PA-Timer-AfterTunnel
PA-Timer-MidStationRev + CONSIST Reverse -> End = PA-Timer-MidStationRev ; CONSIST Horn
PA-Timer-BeforeTunnel  + CONSIST Forward -> End = PA-Timer-BeforeTunnel  ; CONSIST Horn
PA-Timer-AfterTunnel   + CONSIST Forward -> End = PA-Timer-AfterTunnel ; CONSIST Horn
PA-Timer-SonoraSpeed   + CONSIST Forward -> End = PA-Timer-SonoraSpeed ; CONSIST Forward = PA-Full-Speed

# Summit
 B370 + CONSIST Forward                    -> Start = PA-Timer-370
 PA-Timer-370                         -> End = PA-Timer-370; CONSIST Forward = PA-Summit-Speed; Start = PA-Timer-370-Stop
 PA-Timer-370-Stop                         -> End = PA-Timer-370; CONSIST Stop; Start = PA-Timer-Summit; CONSIST Horn
 PA-Timer-Summit                      -> End = PA-Timer-Summit ; CONSIST Horn; CONSIST Reverse = PA-Summit-Speed ; 
 !B370 + CONSIST Reverse                    -> Start = PA-Timer-FullSpeedRev
 PA-Timer-FullSpeedRev -> End = PA-Timer-FullSpeedRev ; CONSIST Reverse = PA-Full-speed ; Start = PA-Timer-MidStationRev

# Arrival
 P3.1 + CONSIST Reverse                    -> Start = PA-Timer-P3.1
 PA-Timer-P3.1 + CONSIST Reverse            -> End = PA-Timer-P3.1 ; CONSIST Reverse = PA-Half-speed ; 
 P3.2 + CONSIST Reverse                    -> Start = PA-Timer-P3.2
 PA-Timer-P3.2 + CONSIST Reverse            -> End = PA-Timer-P3.2; CONSIST Stop ; CONSIST Horn; REAR Light = 0; Start = PA-Timer-Enable # at station
 PA-Timer-Enable + CONSIST Stop            -> End = PA-Timer-Enable; PA-Enable = 1; CONSIST Horn

# Teardown
!PA-Toggle + !CONSIST Reverse + !P3.2      -> CONSIST Reverse = PA-Full-Speed ; 
!PA-Toggle +  CONSIST Stopped              -> CONSIST Sound = 0 ; REAR Sound = 0;


